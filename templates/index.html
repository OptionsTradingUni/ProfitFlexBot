<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Options Trading University - Live Trading Signals</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    :root {
      --bg-primary: #0a0e1a;
      --bg-secondary: #1a1f2e;
      --bg-tertiary: #2d3748;
      --text-primary: #e5e7eb;
      --text-secondary: #94a3b8;
      --text-muted: #64748b;
      --accent-primary: #667eea;
      --accent-secondary: #764ba2;
      --success: #22c55e;
      --danger: #ef4444;
      --border-color: rgba(255,255,255,0.1);
    }
    
    [data-theme="light"] {
      --bg-primary: #f8f9fa;
      --bg-secondary: #ffffff;
      --bg-tertiary: #e9ecef;
      --text-primary: #212529;
      --text-secondary: #6c757d;
      --text-muted: #adb5bd;
      --border-color: rgba(0,0,0,0.1);
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      transition: background 0.3s ease, color 0.3s ease;
    }
    
    /* Top Controls */
    .top-controls {
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-color);
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    .controls-left {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
    }
    
    .controls-right {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    
    .search-box {
      position: relative;
    }
    
    .search-box input {
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 10px 15px;
      padding-left: 40px;
      color: var(--text-primary);
      font-size: 14px;
      width: 250px;
      transition: all 0.3s ease;
    }
    
    .search-box input:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .search-icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-muted);
    }
    
    .filter-btn, .export-btn, .theme-toggle {
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 10px 16px;
      color: var(--text-primary);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .filter-btn:hover, .export-btn:hover, .theme-toggle:hover {
      background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
      border-color: var(--accent-primary);
      transform: translateY(-2px);
    }
    
    .filter-btn.active {
      background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
      border-color: var(--accent-primary);
    }
    
    /* Live Ticker */
    .live-ticker {
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
      padding: 12px 20px;
      overflow: hidden;
      position: relative;
    }
    
    .ticker-content {
      display: flex;
      gap: 40px;
      animation: scroll 30s linear infinite;
      white-space: nowrap;
    }
    
    @keyframes scroll {
      0% { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }
    
    .ticker-item {
      color: #fff;
      font-size: 14px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    /* Hero Section */
    .hero {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 60px 20px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    
    .hero::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      animation: rotate 30s linear infinite;
    }
    
    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    .hero-content { position: relative; z-index: 1; }
    
    .hero h1 {
      font-size: clamp(32px, 5vw, 48px);
      font-weight: 800;
      color: #fff;
      margin-bottom: 16px;
      text-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }
    
    .hero p {
      font-size: clamp(16px, 3vw, 20px);
      color: rgba(255,255,255,0.9);
      margin-bottom: 30px;
    }
    
    .trust-badges {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-top: 30px;
      flex-wrap: wrap;
    }
    
    .badge {
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(10px);
      padding: 12px 24px;
      border-radius: 50px;
      color: #fff;
      font-size: 14px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .hero-stats {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin-top: 40px;
      flex-wrap: wrap;
    }
    
    .stat {
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      padding: 20px 30px;
      border-radius: 12px;
      min-width: 150px;
    }
    
    .stat-value {
      font-size: clamp(24px, 4vw, 32px);
      font-weight: 700;
      color: #fff;
    }
    
    .stat-label {
      font-size: 14px;
      color: rgba(255,255,255,0.8);
      margin-top: 5px;
    }
    
    /* Container */
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 40px 20px;
    }
    
    /* Tabs */
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
      border-bottom: 2px solid var(--border-color);
      overflow-x: auto;
    }
    
    .tab {
      padding: 12px 24px;
      background: transparent;
      border: none;
      color: var(--text-secondary);
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      position: relative;
      transition: all 0.3s ease;
      white-space: nowrap;
    }
    
    .tab:hover {
      color: var(--accent-primary);
    }
    
    .tab.active {
      color: var(--accent-primary);
    }
    
    .tab.active::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
    }
    
    /* Trade Cards Grid */
    .trades-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 25px;
      margin-bottom: 40px;
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .trade-card {
      background: linear-gradient(145deg, var(--bg-secondary), var(--bg-tertiary));
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 25px;
      transition: all 0.3s ease;
      cursor: pointer;
      animation: slideIn 0.5s ease;
    }
    
    .trade-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 40px rgba(102, 126, 234, 0.2);
      border-color: rgba(102, 126, 234, 0.5);
    }
    
    .trade-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .symbol {
      font-size: 24px;
      font-weight: 700;
      color: var(--text-primary);
    }
    
    .time-ago {
      font-size: 12px;
      color: var(--text-muted);
    }
    
    .broker {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 15px;
    }
    
    .profit-display {
      font-size: 32px;
      font-weight: 800;
      margin: 15px 0;
    }
    
    .profit-positive { color: var(--success); }
    .profit-negative { color: var(--danger); }
    
    .roi {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 15px;
    }
    
    .trader-name {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 15px;
    }
    
    .view-btn {
      display: inline-block;
      background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
      color: #fff;
      padding: 10px 20px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
    }
    
    .view-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
    }
    
    /* Modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .modal-content {
      background: var(--bg-secondary);
      margin: 5% auto;
      padding: 30px;
      border-radius: 20px;
      max-width: 800px;
      max-height: 85vh;
      overflow-y: auto;
      position: relative;
      animation: slideUp 0.3s ease;
    }
    
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(50px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .close-modal {
      position: absolute;
      right: 20px;
      top: 20px;
      font-size: 32px;
      font-weight: bold;
      color: var(--text-secondary);
      cursor: pointer;
      transition: color 0.3s ease;
    }
    
    .close-modal:hover {
      color: var(--accent-primary);
    }
    
    /* Charts */
    .chart-container {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 25px;
      margin-bottom: 30px;
    }
    
    .chart-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 20px;
      color: var(--text-primary);
    }
    
    /* Leaderboard */
    .leaderboard {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 25px;
    }
    
    .leaderboard-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      border-bottom: 1px solid var(--border-color);
      transition: background 0.3s ease;
    }
    
    .leaderboard-item:hover {
      background: var(--bg-tertiary);
    }
    
    .leaderboard-item:last-child {
      border-bottom: none;
    }
    
    .rank {
      font-size: 24px;
      font-weight: 800;
      background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      min-width: 50px;
    }
    
    /* Loading */
    .loading {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-muted);
    }
    
    .spinner {
      border: 3px solid var(--border-color);
      border-top: 3px solid var(--accent-primary);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .trades-grid {
        grid-template-columns: 1fr;
      }
      .search-box input {
        width: 100%;
      }
      .top-controls {
        flex-direction: column;
      }
      .controls-left, .controls-right {
        width: 100%;
        justify-content: space-between;
      }
    }
  </style>
</head>
<body>
  <!-- Top Controls -->
  <div class="top-controls">
    <div class="controls-left">
      <div class="search-box">
        <span class="search-icon">🔍</span>
        <input type="text" id="searchInput" placeholder="Search by symbol or trader...">
      </div>
      <button class="filter-btn" data-filter="all">📊 All</button>
      <button class="filter-btn" data-filter="stock">📈 Stocks</button>
      <button class="filter-btn" data-filter="crypto">₿ Crypto</button>
      <button class="filter-btn" data-filter="forex">💱 Forex</button>
      <button class="filter-btn" data-filter="options">🎯 Options</button>
    </div>
    <div class="controls-right">
      <button class="export-btn" onclick="exportToCSV()">📥 Export CSV</button>
      <button class="theme-toggle" onclick="toggleTheme()">🌓 Theme</button>
    </div>
  </div>

  <!-- Live Ticker -->
  <div class="live-ticker">
    <div class="ticker-content" id="ticker">
      <span class="ticker-item">🔴 LIVE</span>
      <span class="ticker-item">📊 Loading market data...</span>
    </div>
  </div>

  <!-- Hero Section -->
  <div class="hero">
    <div class="hero-content">
      <h1>🚀 Options Trading University</h1>
      <p>Real-time trading signals from verified traders across stocks, crypto, and options</p>
      
      <div class="trust-badges">
        <div class="badge">✅ Verified Traders</div>
        <div class="badge">🔐 Blockchain Secured</div>
        <div class="badge">📊 Real-time Data</div>
        <div class="badge">🏆 1,500+ Members</div>
      </div>
      
      <div class="hero-stats">
        <div class="stat">
          <div class="stat-value" id="total-trades">-</div>
          <div class="stat-label">Total Trades</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="total-profit">-</div>
          <div class="stat-label">Total Profit</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="win-rate">-</div>
          <div class="stat-label">Win Rate</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Container -->
  <div class="container">
    <!-- Tabs -->
    <div class="tabs">
      <button class="tab active" data-tab="trades">📊 Recent Trades</button>
      <button class="tab" data-tab="performance">📈 Performance</button>
      <button class="tab" data-tab="leaderboard">🏆 Top Traders</button>
    </div>

    <!-- Trades Tab -->
    <div id="trades-tab" class="tab-content">
      <div id="trades-container">
        <div class="loading">
          <div class="spinner"></div>
          <p>Loading recent trades...</p>
        </div>
      </div>
    </div>

    <!-- Performance Tab -->
    <div id="performance-tab" class="tab-content" style="display:none;">
      <div class="chart-container">
        <h3 class="chart-title">📈 Profit Over Time</h3>
        <canvas id="profitChart"></canvas>
      </div>
      <div class="chart-container">
        <h3 class="chart-title">📊 Asset Distribution</h3>
        <canvas id="assetChart"></canvas>
      </div>
    </div>

    <!-- Leaderboard Tab -->
    <div id="leaderboard-tab" class="tab-content" style="display:none;">
      <div class="leaderboard" id="leaderboard-container">
        <div class="loading">
          <div class="spinner"></div>
          <p>Loading top traders...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Trade Modal -->
  <div id="tradeModal" class="modal">
    <div class="modal-content">
      <span class="close-modal" onclick="closeModal()">&times;</span>
      <div id="modalBody"></div>
    </div>
  </div>

  <script>
    let allTrades = [];
    let currentFilter = 'all';
    let searchQuery = '';
    
    // Theme Toggle
    function toggleTheme() {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      document.documentElement.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
    }
    
    // Load saved theme
    const savedTheme = localStorage.getItem('theme') || 'dark';
    document.documentElement.setAttribute('data-theme', savedTheme === 'light' ? 'light' : '');
    
    // Tab Switching
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        const tabName = tab.getAttribute('data-tab');
        document.querySelectorAll('.tab-content').forEach(content => {
          content.style.display = 'none';
        });
        document.getElementById(`${tabName}-tab`).style.display = 'block';
        
        if (tabName === 'performance') {
          renderCharts();
        } else if (tabName === 'leaderboard') {
          renderLeaderboard();
        }
      });
    });
    
    // Filter Buttons
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentFilter = btn.getAttribute('data-filter');
        renderTrades();
      });
    });
    
    // Search
    document.getElementById('searchInput').addEventListener('input', (e) => {
      searchQuery = e.target.value.toLowerCase();
      renderTrades();
    });
    
    // Fetch and display data
    fetch('/api/recent')
      .then(res => res.json())
      .then(data => {
        if (!data || data.length === 0) {
          document.getElementById('trades-container').innerHTML = '<div class="loading"><p>No trades available yet.</p></div>';
          return;
        }
        
        allTrades = data;
        
        // Update stats
        const totalTrades = data.length;
        const totalProfit = data.reduce((sum, t) => sum + t.profit, 0);
        const winningTrades = data.filter(t => t.profit > 0).length;
        const winRate = ((winningTrades / totalTrades) * 100).toFixed(1);
        
        document.getElementById('total-trades').textContent = totalTrades;
        document.getElementById('total-profit').textContent = '$' + totalProfit.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
        document.getElementById('win-rate').textContent = winRate + '%';
        
        // Update ticker
        updateTicker(data);
        
        // Render trades
        renderTrades();
      })
      .catch(err => {
        console.error('Error loading trades:', err);
        document.getElementById('trades-container').innerHTML = '<div class="loading"><p>Unable to load trades. Please try again later.</p></div>';
      });
    
    function updateTicker(data) {
      const ticker = document.getElementById('ticker');
      const latest = data.slice(0, 10);
      const items = latest.map(t => {
        const emoji = t.profit >= 0 ? '📈' : '📉';
        const sign = t.profit >= 0 ? '+' : '';
        return `<span class="ticker-item">${emoji} ${t.symbol}: ${sign}$${t.profit.toLocaleString()} (${sign}${t.roi.toFixed(1)}%)</span>`;
      });
      // Duplicate for seamless loop
      ticker.innerHTML = items.join('') + items.join('');
    }
    
    function renderTrades() {
      let filtered = allTrades;
      
      // Apply filter based on actual asset_type from database
      if (currentFilter !== 'all') {
        filtered = filtered.filter(t => {
          const assetType = (t.asset_type || 'stock').toLowerCase();
          
          if (currentFilter === 'stock') {
            return assetType === 'stock';
          }
          if (currentFilter === 'crypto') {
            return assetType === 'crypto' || assetType === 'meme' || assetType === 'crypto_multi';
          }
          if (currentFilter === 'forex') {
            return assetType === 'forex';
          }
          if (currentFilter === 'options') {
            return assetType === 'option';
          }
          
          return true;
        });
      }
      
      // Apply search
      if (searchQuery) {
        filtered = filtered.filter(t => 
          t.symbol.toLowerCase().includes(searchQuery) || 
          t.trader_name.toLowerCase().includes(searchQuery) ||
          t.broker_name.toLowerCase().includes(searchQuery)
        );
      }
      
      const container = document.getElementById('trades-container');
      
      if (filtered.length === 0) {
        container.innerHTML = '<div class="loading"><p>No trades match your filters.</p></div>';
        return;
      }
      
      container.innerHTML = '<div class="trades-grid">' + filtered.map(trade => `
        <div class="trade-card" onclick="showTradeModal('${trade.txid}')">
          <div class="trade-header">
            <div class="symbol">${trade.symbol}</div>
            <div class="time-ago">${trade.time_ago}</div>
          </div>
          <div class="broker">🏦 ${trade.broker_name}</div>
          <div class="profit-display ${trade.profit >= 0 ? 'profit-positive' : 'profit-negative'}">
            ${trade.profit >= 0 ? '+' : ''}$${Math.abs(trade.profit).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}
          </div>
          <div class="roi ${trade.profit >= 0 ? 'profit-positive' : 'profit-negative'}">
            ${trade.roi >= 0 ? '+' : ''}${trade.roi.toFixed(2)}% ROI
          </div>
          <div class="trader-name">
            👤 ${trade.trader_name}
          </div>
          <button class="view-btn" onclick="event.stopPropagation(); window.location.href='/log/${trade.txid}';">📊 View Full Report</button>
        </div>
      `).join('') + '</div>';
    }
    
    function renderCharts() {
      // Profit over time chart
      const profitCtx = document.getElementById('profitChart');
      if (profitCtx && !profitCtx.chart) {
        const dates = allTrades.map(t => new Date(t.posted_at).toLocaleDateString()).reverse();
        const cumProfit = [];
        let sum = 0;
        allTrades.reverse().forEach(t => {
          sum += t.profit;
          cumProfit.push(sum);
        });
        
        profitCtx.chart = new Chart(profitCtx, {
          type: 'line',
          data: {
            labels: dates,
            datasets: [{
              label: 'Cumulative Profit',
              data: cumProfit,
              borderColor: '#667eea',
              backgroundColor: 'rgba(102, 126, 234, 0.1)',
              fill: true,
              tension: 0.4
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { display: false }
            }
          }
        });
      }
      
      // Asset distribution chart
      const assetCtx = document.getElementById('assetChart');
      if (assetCtx && !assetCtx.chart) {
        const assetCounts = {};
        allTrades.forEach(t => {
          const type = t.symbol.includes('/') ? 'Forex/Crypto' : 'Stocks';
          assetCounts[type] = (assetCounts[type] || 0) + 1;
        });
        
        assetCtx.chart = new Chart(assetCtx, {
          type: 'doughnut',
          data: {
            labels: Object.keys(assetCounts),
            datasets: [{
              data: Object.values(assetCounts),
              backgroundColor: ['#667eea', '#764ba2', '#22c55e', '#ef4444']
            }]
          },
          options: {
            responsive: true
          }
        });
      }
    }
    
    function renderLeaderboard() {
      const traders = {};
      allTrades.forEach(t => {
        if (!traders[t.trader_name]) {
          traders[t.trader_name] = { name: t.trader_name, profit: 0, trades: 0, wins: 0 };
        }
        traders[t.trader_name].profit += t.profit;
        traders[t.trader_name].trades += 1;
        if (t.profit > 0) traders[t.trader_name].wins += 1;
      });
      
      const sorted = Object.values(traders).sort((a, b) => b.profit - a.profit).slice(0, 10);
      
      const container = document.getElementById('leaderboard-container');
      container.innerHTML = sorted.map((trader, idx) => {
        const winRate = (trader.wins / trader.trades * 100).toFixed(1);
        return `
          <div class="leaderboard-item">
            <div class="rank">#${idx + 1}</div>
            <div>
              <div style="font-weight: 700; font-size: 18px;">${trader.name}</div>
              <div style="color: var(--text-secondary); font-size: 14px;">${trader.trades} trades • ${winRate}% win rate</div>
            </div>
            <div style="font-size: 24px; font-weight: 800; color: ${trader.profit >= 0 ? 'var(--success)' : 'var(--danger)'};">
              ${trader.profit >= 0 ? '+' : ''}$${trader.profit.toLocaleString()}
            </div>
          </div>
        `;
      }).join('');
    }
    
    function showTradeModal(txid) {
      const trade = allTrades.find(t => t.txid === txid);
      if (!trade) return;
      
      const modal = document.getElementById('tradeModal');
      const modalBody = document.getElementById('modalBody');
      
      modalBody.innerHTML = `
        <h2 style="margin-bottom: 20px;">${trade.symbol} Trade Details</h2>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
          <div>
            <p><strong>Trader:</strong> ${trade.trader_name}</p>
            <p><strong>Broker:</strong> ${trade.broker_name}</p>
            <p><strong>TXID:</strong> ${trade.txid}</p>
            <p><strong>Time:</strong> ${trade.time_ago}</p>
          </div>
          <div>
            <p><strong>Profit:</strong> <span style="color: ${trade.profit >= 0 ? 'var(--success)' : 'var(--danger)'};">${trade.profit >= 0 ? '+' : ''}$${trade.profit.toLocaleString()}</span></p>
            <p><strong>ROI:</strong> <span style="color: ${trade.roi >= 0 ? 'var(--success)' : 'var(--danger)'};">${trade.roi >= 0 ? '+' : ''}${trade.roi.toFixed(2)}%</span></p>
          </div>
        </div>
        <div style="margin-top: 30px;">
          <a href="/log/${trade.txid}" class="view-btn" style="display: inline-block;">View Full Verification Report</a>
        </div>
      `;
      
      modal.style.display = 'block';
    }
    
    function closeModal() {
      document.getElementById('tradeModal').style.display = 'none';
    }
    
    window.onclick = function(event) {
      const modal = document.getElementById('tradeModal');
      if (event.target == modal) {
        modal.style.display = 'none';
      }
    }
    
    function exportToCSV() {
      const headers = ['Symbol', 'Trader', 'Broker', 'Profit', 'ROI', 'Time'];
      const rows = allTrades.map(t => [
        t.symbol,
        t.trader_name,
        t.broker_name,
        t.profit.toFixed(2),
        t.roi.toFixed(2) + '%',
        t.time_ago
      ]);
      
      const csvContent = [headers, ...rows].map(row => row.join(',')).join('\n');
      const blob = new Blob([csvContent], { type: 'text/csv' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `trades_${new Date().toISOString().split('T')[0]}.csv`;
      a.click();
    }
  </script>
</body>
</html>
